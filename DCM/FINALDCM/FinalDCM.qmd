---
title: "Final Assignment DCM - Young Migrants and Degree Choice"
author: "Marc Sparhuber"
format: pdf
editor: source
execute:
  warning: false
  echo: false
toc: true
header-includes:
      - \usepackage{float}
      - \floatplacement{table}{H}
engine: knitr
bibliography: references.bib
csl: apa.csl
---

\newpage

```{r}
library(tidyverse)
library(tidymodels)
library(survival)
library(kableExtra)
library(gtsummary)
library(haven)

og_data <- read_dta(here::here("DCM","FINALDCM", "acs_2015.dta"))

og_data$degfield <- labelled::to_factor(og_data$degfield)
og_data$degfieldd <- labelled::to_factor(og_data$degfieldd)
og_data$degfield2 <- labelled::to_factor(og_data$degfield2)
og_data$degfield2d <- labelled::to_factor(og_data$degfield2d)
og_data$empstat <- labelled::to_factor(og_data$empstat)
og_data$rachsing <- labelled::to_factor(og_data$rachsing)
og_data$stateicp <- labelled::to_factor(og_data$stateicp)
og_data$met2013 <- labelled::to_factor(og_data$met2013)
og_data$bpld <- labelled::to_factor(og_data$bpld)
og_data$bpl <- labelled::to_factor(og_data$bpl)
og_data$occ <- labelled::to_factor(og_data$occ)
og_data$citizen <- labelled::to_factor(og_data$citizen)
og_data$Sex <- labelled::to_factor(og_data$sex)
og_data$`Educational Attainment` <- labelled::to_factor(og_data$educ)
```

## Introduction


> With migration expected to rise drastically in the coming decades, issues of integration continuously rise in relevance. One aspect of migration is educational attainment and more specifically choice of degree field in tertiary education, as getting a degree serves as a vehicle for upward social mobility. Especially for individuals who have migrated at a young age, who have yet to make their decisions regarding their education, different reasons for degree choice may be paramount compared to non-migrants of their age cohort. Thus, the central research question of this research paper is whether individuals who have migrated at a young age differ in their choice of tertiary education to non-migrants. Connected to this are the questions of whether their access to education is the same as that of their non-migrant peers and what hopes and attributions are connected to certain degree fields.

> To answer these questions, binary, multinomial and conditional logistic regressions are employed. The analysis is based on data from the American Community Survey 2015, which is a demographic survey conducted yearly by the United States Census Bureau. It contains individual and household-level information about demographic, educational, and financial information, among other fields. My findings indicate that although college access seems to be influenced by age at migration, covariates such as race and birthplace play a greater role at informing choice of degree.

## Background

> There is a body of work which has already mostly answered the questions above. Many studies have highlighted the lower the age of migration, the better the educational attainment overall, some even finding a causal effect [e.g., @ansala2020; @glick2016; @lemmermann2018]. Other variables typically associated with educational attainment also play a role here: parental education and income, school quality, social capital, neighborhood quality, among others [@baum2011; @portes1999]. Another important variable is being able to speak the target country's language [@baum2011; @lemmermann2018]. A theory suggesting an explanation for this is child development theory, which posits that the younger an individual is, the easier it is for it to change and adapt to a new environment and the "cost" of adopting a new identity is lower than for older individuals [@beck2012].


> Interestingly, the first two generations of migrants tend to achieve higher levels of tertiary education than natives, which was termed the "immigration advantage" and is hypothesized to be due to either positive selection (immigrants show higher levels of motivation and human capital than the average person from their country) or immigrant optimism, which ascribes immigrants higher expectations and motivations in the form of psychological resources to overcome socioeconomic hardships in their target country [@portes2011]. While information on degree choice among migrants seems sparse, ethnicity seems to predict it somewhat, with first- and second generation Asians being significantly more likely to attend university and college than natives [@hagy2002]. This is in line with findings that Asian Americans are tend to purse education leading to higher earnings and requiring higher education and enter into degrees that tend to be more financially rewarding [@xie2003]. This seems to be in part due to the fact that individuals in degree related occupations tend to encourage youths from their own demographic groups to pursue degrees related to their occupations [@ma2011].

> It is expected that though there may be fewer young migrants choosing to pursue tertiary education due to the associated costs compared to their non-migrant counterparts, those who do are driven by strong sense of utility in their choice of studies, therefore choosing fields commonly associated with higher prestige and better financial stability. Additionally, the attributed outcomes associated with degree choice are expected to primarily be related to financial stability and prestige.

> This analysis has a breadth of potential confounders and mediators to take into account, many of which are expected to interact with one another and not all of which are included in the data. Sex is expected to serve as a strong confounder, as several fields of study are strongly gender segregated. This effect is expected to differ, however, based on the socialization at home, where variables such as religion, country of birth as well as parent related variables may show interactions with sex and have their own confounding effects. Citizenship status may influence whether college is attended at all, as undocumented students may choose to not attend college due to either thinking that they are not allowed to do so or because their funding options by the state are reduced. Additionally, degree choices may be greatly influenced by the age at which an individual has migrated to the US country. Due to this, some of the following models take this into account.

```{r desctable}

data <- og_data

# Deal with Nas and empty levels
data$degfield <- fct_recode(data$degfield, NULL = "N/A")
data$citizen <- fct_recode(data$citizen, "Citizen" = "N/A")
data$empstat <- fct_recode(data$empstat, NULL = "N/A")

data$citizen <- droplevels(data$citizen)
data$empstat <- droplevels(data$empstat)
data$`Educational Attainment` <- droplevels(data$`Educational Attainment`)
data$Sex <- droplevels(data$Sex)

 
data <- data |> 
  select(Sex,age,stateicp,met2013,birthyr,bpl,citizen,yrimmig,yrsusa1,rachsing,educd,degfield,empstat,uhrswork,inctot,incearn,poverty,`Educational Attainment`) |>
  mutate(
   age_at_immigration = if_else(yrimmig != 0, yrimmig - (2015-age), NA_integer_),
   young_migrant = if_else(!is.na(age_at_immigration) & age_at_immigration >= 0 & age_at_immigration <= 19 & citizen != "Born abroad of American parents", "YM", "Not YM"),
   young_migrant = as_factor(young_migrant),
   `Migration Status` = case_when(young_migrant == "YM" & age_at_immigration < 10 ~ "Migrated as Child (younger than 10 years old)",
                             young_migrant == "YM" & age_at_immigration >= 10 & age_at_immigration <= 19 ~ "Migrated as Adolescent (between 10 and 19 years old)",
                             age_at_immigration >= 20 & citizen != "Born abroad of American parents" ~ "Migrated as Adult (20 and older)",
                             young_migrant == "Not YM" | citizen == "Born abroad of American parents"  ~ "Did not Migrate"),
   `Migration Status` = fct_relevel(`Migration Status`, "Migrated as Child (younger than 10 years old)", "Migrated as Adolescent (between 10 and 19 years old)", "Migrated as Adult (20 and older)", "Did not Migrate"),
   `Educational Attainment` = fct_collapse(`Educational Attainment`,
                       other_level = "Did not Finish High School",
                       `Finished High School` = c("Grade 12"),
                       `Some College` = c("1 year of college", "2 years of college"),
                       `Bachelor's Degree` = c("4 years of college"),
                       `Master's Degree or Doctorate` = c("5+ years of college")),
   `Educational Attainment` = fct_relevel(`Educational Attainment`, "Did not Finish High School")
   ) |> 
  rename(`Race` = rachsing) |> 
  filter(birthyr >= 1960 & age >= 24 & inctot < 9999998 & poverty != 0)

attributes(data$Race)$label <- "Race (simplified)"

data$degfield <- droplevels(data$degfield)
data$bpl <- droplevels(data$bpl)

# make broader categories for degfield
data <- data |> mutate(
  `Field of Degree` = fct_collapse(degfield,
    Engineering = c("Architecture", "Communication Technologies", "Engineering", "Engineering Technologies", "Military Technologies", "Nuclear, Industrial Radiology, and Biological Technologies", "Construction Services", "Electrical and Mechanic Repairs and Technologies", "Transportation Sciences and Technologies"),
    Sciences = c("Agriculture", "Environment and Natural Resources", "Computer and Information Sciences", "Biology and Life Sciences", "Physical Sciences", "Mathematics and Statistics"),
    Arts = c("Area, Ethnic, and Civilization Studies", "Cosmetology Services and Culinary Arts", "Linguistics and Foreign Languages", "English Language, Literature, and Composition", "Liberal Arts and Humanities", "Library Science", "Physical Fitness, Parks, Recreation, and Leisure", "Philosophy and Religious Studies", "Fine Arts", "History"),
    `Social Sciences` = c("Communications", "Family and Consumer Sciences", "Psychology", "Public Affairs, Policy, and Social Work", "Social Sciences"),
    Medicine = c("Medical and Health Sciences and Services"),
    Business = c("Business"),
    Education = c("Education Administration and Teaching"),
    other_level = "Other"
  ),
  `Field of Degree` = fct_relevel(`Field of Degree`, "Business"),
  Sex = as_factor(Sex),
  bpl_collapsed = fct_collapse(bpl,
                     other_level = "North America",
                     LatAm = c("Mexico","Central America","Cuba","Americas, n.s.","West Indies","SOUTH AMERICA"),
                     `Western Europe & Scandinavia` = c("Denmark", "Finland", "Iceland", "Norway", "Sweden", "England", "Scotland", "United Kingdom, ns", "Ireland", "Belgium", "France", "Netherlands", "Switzerland", "Greece", "Italy","Portugal", "Spain", "Austria", "Germany"),
                     `Eastern Europe` = c("Albania", "Bulgaria", "Czechoslovakia", "Hungary", "Poland", "Romania", "Yugoslavia", "Latvia", "Lithuania", "Other USSR/Russia", "Europe, ns", "Cyprus"),
                     `East Asia` = c("China", "Japan", "Korea"),
                     `South & South-East Asia` = c("India" ,"Cambodia (Kampuchea)", "Indonesia", "Laos", "Malaysia","Philippines","Singapore","Thailand","Vietnam", "Nepal", "Asia, nec/ns"),
                     `Middle East` = c("Afghanistan", "Iran","Iraq","Israel/Palestine", "Jordan","Kuwait","Lebanon","Saudi Arabia","Syria","Turkey","United Arab Emirates", "Yemen Arab Republic (North)"),
                     Africa = c("AFRICA"),
                     Oceania = c("Australia and New Zealand", "Pacific Islands")
  ),
  bpl_collapsed = fct_relevel(bpl_collapsed, "North America"),
  `Has a Degree` = if_else(`Educational Attainment` == "Master's Degree or Doctorate" | `Educational Attainment` == "Bachelor's Degree", "1", "0"),
  `Has a Degree` = fct_relevel(`Has a Degree`, "0")
)

data$Sex <- droplevels(data$Sex)


data |>
  select(`Migration Status`,`Age (in years)` = age, `Sex` =  Sex, `Age (in years)` = age, `Citizenship Status` = citizen, `Race`, `Educational Attainment` = `Educational Attainment`, `Employment Status` = empstat, uhrswork, inctot, incearn, `Poverty Status` = poverty) |> 
  tbl_summary(by = `Migration Status`, type = list(`Age (in years)` ~ "continuous",
                                                   uhrswork ~ "continuous",
                                                   inctot ~ "continuous",
                                                   `Poverty Status` ~ "continuous")) |>
  modify_caption("Educational and Economical Indicators: Descriptives Divided by Migration Status") |>
  as_kable_extra(booktabs = TRUE, escape = FALSE, linesep = "") |>
  kable_styling(latex_options = "scale_down") |> 
  footnote(footnote_as_chunk = TRUE,
           threeparttable = TRUE, 
           general = "Shows only those respondents who were born after 1960 and at least 24 years old in 2015. 
           Poverty Status is calculated taking into account household size, household member's age, age of the householder and total family income: 
           Values over 100 indicate being above the poverty threshold. Data from the American Community Survey 2015 (collected 2015).")
```

## Data

> The data for the 2015 American Community Survey was gathered over the course of the year 2015, containing more than 3 million individuals and is representative for the inhabitants of the Unites States of America. Of these data, only those individuals are taken into account that were born 1960 or later. This is to ensure that all individuals had the chance to do all types of degrees with especially degrees such as computer science only being widely represented at colleges around the late 70s. Further, depending on the analysis, only employed individuals are included. Individuals containing missing values in any of the variables of interest are dropped from the analysis.

> The main dependent variable is the choice of degree. For the multinomial regression, the degrees are grouped into broader fields, whereas the conditional logit model takes into account all degrees as alternatives in which at least 1000 individuals received a degree. For the binary model, the predicted variable is holding a degree or not. Migration status is considered the main independent variable. It is a categorical variable with the 4 levels "Migrated as Child", "Migrated as Adolescent", "Migrated as Adult" and, "Did not Migrate". The split into these 4 categories is motivated theoretically, as there is expected to be a greater assimilation of migrants, the younger they enter the country and vastly different patterns in the group of adult migrants. Individuals who are born abroad to American parents and then moved to the U.S are not considered migrants in this analysis, due to the assumption that they may adapt to their new environment much easier than other migrants due to the knowledge of their parents. Other independent variables are simplified versions of the birthplace, race, (and migration status) variables, as these have been highlighted in the literature and are available in the data.

> Table 1 presents the descriptives divided by migration status. For categorical variables percentages are displayed and for continuous variables, the median and interquartile range are supplied. Across the entire table it becomes apparent that individuals who migrate as children quite closely resemble the descriptive statistics of those who never migrated at all, compared to those who migrated as adults. There seems to be a trend to be worse off when having migrated as an adult compared to all other groups, with a lower total personal and total earned income than the other groups. However, the educational attainment variable results for this group show that this might not be due to low education, as this group contains the highest percentage of degree holders, hinting toward distinct differences between highly educated individuals migrating to the US and less qualified migrants. Comparing the child and adolescent migrants, it becomes apparent that the latter performs worse than the prior in all educational and financial variables, being the most at risk group of all four compared.

```{r desc2}
data |>
  select(`Migration Status`,`Age (in years)` = age, `Sex` =  Sex, `Age (in years)` = age, `Citizenship Status` = citizen, `Race`, `Educational Attainment` = `Educational Attainment`, `Employment Status` = empstat, uhrswork, inctot, incearn, `Poverty Status` = poverty, `Field of Degree`) |> 
  tbl_summary(by = `Field of Degree`, type = list(`Age (in years)` ~ "continuous",
                                                   uhrswork ~ "continuous",
                                                   inctot ~ "continuous",
                                                   `Poverty Status` ~ "continuous")) |>
  modify_caption("Educational and Economical Indicators: Descriptives Divided by Field of Degree") |>
  as_kable_extra(booktabs = TRUE, escape = FALSE, linesep = "") |>
  kable_styling(latex_options = "scale_down") |> 
  footnote(footnote_as_chunk = TRUE,
           threeparttable = TRUE, 
           general = "Shows only those respondents who were born after 1960 and at least 24 years old in 2015. Poverty Status is calculated taking into account household size, household member's age, age of the householder and total family income: Values over 100 indicate being above the poverty threshold. Data from the American Community Survey 2015 (collected 2015).")
```

> Table 2 presents the variables in the way they will appear in the multinomial regression. Its results seem to be in concord with the findings of prior research with Asians holding more degrees in Engineering, the Sciences and Medicine, while at the same time being less represented in low paying degree fields such as Education. A similar observation can be made for individuals who migrated young, where the same pattern follows, albeit less pronounced. Interestingly, individuals who migrated as adults are also over-represented in these fields, which would be in line with the finding that individuals with high human capital are more likely to migrate (though it has to be said that this graph also excludes those who hold no degree at all).

## Methods

> To test whether the access of young migrants to tertiary education is different than for natives, a binary model with a dummy variable for holding a college degree is used. The 4-category migration status variable is used to differentiate the groups of interest. Age is not added, as it is heavily influenced by the sub-sampling process and the migration status variable. In the final model, possibly associated variables with holding a degree are included. Only those who were employed at the time are included. A sample of 30000 individuals is used for this model.

> The central research question of degree field by migration status and other variables associated with it named in the literature is tested in a multinomial model with the outcome variable being the degree field individuals hold a degree in. Therefore, participants who do not hold a degree are excluded in this analysis.

> The final research question also excludes those without degrees and is attempted to be answered using a conditional choice model, with the alternatives being the different degree fields (those with under 1000 degree holders are excluded), and alternative specific variables. To distinguish between the groups of interest, a dichotomous version of the migration status variable is used as an interaction term for all present predictors. The choice makers are a sample of currently employed degree holders. All choice makers are "presented" with 4 alternatives as well as their actually chosen alternative.

## Results

```{r binary}
# here just compare the YM with other people - how are they unique? do they earn more or less? are they more poor?
# I.E., regardless of expectation - what does it look like for YM?

data_bin <- data |> slice_sample(n = 30000) |> rename(`Age at Migration` = age_at_immigration) |> mutate(`Migration Status` = fct_relevel(`Migration Status`, "Did not Migrate")) |> filter(empstat == "Employed")

mod1 <- glm(`Has a Degree` ~ `Migration Status`, data = data_bin, 
                       family = "binomial"(link = "logit"))

t1 <- tbl_regression(mod1, exponentiate = TRUE) |> 
  modify_header(list(label="**Covariate**",
                     estimate="**OR**")) |>
  modify_footnote(update = list(estimate ~ NA), 
                  abbreviation=TRUE)

mod2 <- glm(`Has a Degree` ~ `Migration Status` + Sex, data = data_bin, 
                       family = "binomial"(link = "logit"))

t2 <- tbl_regression(mod2, exponentiate = TRUE) |> 
  modify_header(list(label="**Covariate**",
                     estimate="**OR**")) |>
  modify_footnote(update = list(estimate ~ NA), 
                  abbreviation=TRUE)

mod3 <- glm(`Has a Degree` ~ `Migration Status` + Sex + uhrswork + inctot + incearn + poverty, data = data_bin, 
                       family = "binomial"(link = "logit"))

t3 <- tbl_regression(mod3, exponentiate = TRUE) |> 
  modify_header(list(label="**Covariate**",
                     estimate="**OR**")) |>
  modify_footnote(update = list(estimate ~ NA), 
                  abbreviation=TRUE)

tbl_merge(tbls = list(t1, t2, t3),
          tab_spanner = c("**Model 1**", "**Model 2**", "**Model 3**")) |> 
  modify_caption("How is Holding a College Degree Associated with Migration Status: Binary Logistic Regression Models") |> 
  as_kable_extra(booktabs = TRUE, escape = FALSE, linesep = "") |> 
  kable_styling(latex_options = "scale_down") |> 
  footnote(footnote_as_chunk = TRUE,
           threeparttable = TRUE, 
           general = "Data from the American Community Survey 2015 (collected 2015). For the definition of Migration Status, see text. Based on a random sub-sample of 30000 individuals.")
```

> Table 3 and 4 show the results and fit statistics for the binary regression. Across all 3 models, compared to reference category of non-migrants, those who migrated as children do not differ greatly in their college attendance. Looking at those who migrated as adolescents - their having migrated later is associated with significant \~0.5 to \~0.7 (slight variation due to quarto sampling problems expected) times lower odds of having completed a college degree than non-migrants. Those who migrated as adults are similar to non-migrants in the first two models but when including post-education predictors, have a significant \~1.4 times higher odds of having finished a degree. Interestingly, there is a rising association with being female and having finished a degree. The inclusion of the post-education predictors significantly improves model fit as can be seen in Table 4, despite their, albeit significant, (aside from earned income) null effects.

```{r gof bin}
#| fig-align: center

lr_12 <- lmtest::lrtest(mod1,mod2)
lr_23 <- lmtest::lrtest(mod2,mod3)

glance_fits <- broom::glance(mod1) |> select(3:5) |>  bind_rows(broom::glance(mod2) |> select(3:5)) |> bind_rows(broom::glance(mod3) |> select(3:5)) |> t() |> as_tibble()

colnames(glance_fits) <- c("Model 1", "Model 2", "Model 3")

data_fit <- as.data.frame(tribble(
  ~`Model 1`, ~`Model 2`, ~`Model 3`,
  NA_integer_, lr_12[2,4], lr_23[2,4], # lr 
  NA_integer_, lr_12[2,3], lr_23[2,3], # df
  NA_integer_, lr_12[2,5], lr_23[2,5] # p
    )
  )

data_fit2 <- as.data.frame(bind_rows(glance_fits,data_fit)) %>% round(.,2)

data_fit2[6,2] <- as.character(signif(data_fit[3,2], 3))
data_fit2[6,3] <- as.character(signif(data_fit[3,3], 3))

rownames(data_fit2) <- c("Log Likelihood", "AIC", "BIC", "Likelihood Ratio", "Likelihood Ratio (Df)", "Likelihood Ratio (p-value)")

data_fit2[is.na(data_fit2)] <- ""

kable(data_fit2,
      align = "c",
      caption = "Holding a College Degree and Migration Status: Model Fit Statistics") |> 
  footnote(footnote_as_chunk = TRUE,
           threeparttable = TRUE, 
           general = "The Likelihood ratio is always calculated with the nested model to the left. Data from the American Community Survey 2015 (collected 2015). Based on a random sub-sample of 30000 individuals.")
```

> Table 5 shows the best fitting of three run multinomial models due to space constraints with the corresponding odds ratios, confidence intervals and asterisks to indicate significance. The comparison of these nested models in regards to their fit statistics can be seen in Table 6. While Gender throughout all named degree fields (with business as a reference category, as it is the field with most degree holders in the sample) reflects the assumed gender distributions of those fields significantly, the main predictor, migration status only shows near significant negative results in regards to a non-selection of Education degrees for those who migrated as a child and a significant negative effect at p \< 0.05 for those who migrated as adolescents. Although the odds ratios for Engineering (high pay, high prestige), are above 1, at \~1.21 and \~1.43 for the two young migrant groups respectively, indicating that being a child or adolescent at migration is associated with \~1.21 and \~1.43 times greater odds of holding an engineering degree, relative to the reference category of Business degrees, these effects are non-significant. Interestingly, the expected effects do occur for adult migrants, however.

> In fact, before introducing race and birthplace into the model, migration status was indeed a significant predictor in many cases but degree choice seems to be better explained by the previous two variables. Citizenship status seems not to be a great predictor. Of birthplace and race, both of which are extremely simplified and admittedly flawed representations, roughly follow the same patterns. Asians (race) can once again significantly be associated with lower odds of holding a degree in education and \~1.97 times greater odds of holding a degree in engineering, relative to the reference category. The fit statistics shown in Table 6 indicate that the currently shown Model 3 is only slightly, yet significantly better than Model 2 which did not include Race and Citizenship as predictors.

```{r multinom}
# which degrees do migrants who enter the country young enter into more and what are their attributes?

data |> select(`Age (in years)` = age, `Sex` =  Sex, citizen, degfield, `Field of Degree`, young_migrant,  `Birthplace (simplified)` = bpl_collapsed ,birthyr, `Migration Status`, `Citizenship Status` = citizen, `Race`, `Educational Attainment` = `Educational Attainment`, `Employment Status` = empstat, uhrswork, inctot, incearn, `Poverty Status` = poverty) |> 
  mutate(`Migration Status` = fct_relevel(`Migration Status`, "Did not Migrate")) |> 
  filter(`Employment Status` == "Employed") -> data_mult

set.seed(1)
data_mult <- data_mult |> slice_sample(n = 100000)

library(nnet)
library(broom)
library(modelr)

multi2 <- multinom(`Field of Degree` ~ `Sex` + `Migration Status` + `Birthplace (simplified)`, data = data_mult, trace = F, model = T, na.action = na.exclude)

multi3 <- multinom(`Field of Degree` ~ `Sex` + `Migration Status` + `Birthplace (simplified)` + `Race` + `Citizenship Status`, data = data_mult, trace = F, model = T, na.action = na.exclude)

multi1 <- multinom(`Field of Degree` ~ `Sex` + `Migration Status`, data = data_mult, trace = F, model = T, na.action = na.exclude)

cm <- c("SexFemale" = "Female (ref. Male)",
        "Migration StatusMigrated as Child (younger than 10 years old)" = "Migrated as Child (younger than 10 years old - ref. Did not Migrate)",
        "Migration StatusMigrated as Adolescent (between 10 and 19 years old)" = "Migrated as Adolescent (between 10 and 19 years old)",
        "Migration StatusMigrated as Adult (20 and older)" = "Migrated as Adult (20 and older)",
        "Birthplace (simplified)LatAm" = "Birthplace: LatAm (ref. United States)",
        "Birthplace (simplified)Western Europe & Scandinavia" = "Birthplace: Western Europe & Scandinavia",
        "Birthplace (simplified)Eastern Europe" = "Birthplace: Eastern Europe",
        "Birthplace (simplified)East Asia" = "Birthplace: East Asia",
        "Birthplace (simplified)South & South-East Asia" = "Birthplace: South & South-East Asia",
        "Birthplace (simplified)Middle East" = "Birthplace: Middle East",
        "Birthplace (simplified)Africa" = "Birthplace: Africa",
        "Birthplace (simplified)Oceania" = "Birthplace: Oceania",
        "RaceBlack/African American" = "Race (simplified): African American (ref. White)",
        "RaceAmerican Indian/Alaska Native" = "Race (simplified): American Indian/Alaska Native",
        "RaceAsian/Pacific Islander" = "Race (simplified): Asian/Pacific Islander",
        "RaceHispanic/Latino" = "Race (simplified): Hispanic/Latino",
        "Citizenship StatusBorn abroad of American parents" = "Citizenship Status: Born abroad of American parents",
        "Citizenship StatusNaturalized citizen" = "Citizenship Status: Naturalized citizen",
        "Citizenship StatusNot a citizen" = "Citizenship Status: Not a citizen")

modelsummary::modelsummary(multi3, shape =  term ~ model + response,
                           title = "Degree Choice and Migration Status: Multinomial logistic regression",
             fmt = 2,
             statistic = 'conf.int',
             exponentiate = TRUE,
             stars = TRUE,
             coef_omit = "Intercept",
             gof_omit ="RMSE|R2|R2 Adj.",
             coef_map = cm,
            notes = list("Source: Data from the American Community Survey 2015. Reference category for the Degree Fields is Business.",
                         "For the number of individuals in each degree field please refer to Table 2, as this model is run on a randomly sampled subset of 100000 individuals.")
             ) |> kable_styling(latex_options = "scale_down")
```

```{r gof multi}
#| fig-align: center

lr_12m <- lmtest::lrtest(multi1,multi2)
lr_23m <- lmtest::lrtest(multi2,multi3)

glance_fitsm <- broom::glance(multi1) |> select(3) |>  bind_rows(broom::glance(multi2) |> select(3)) |> bind_rows(broom::glance(multi3) |> select(3)) |> t() |> as_tibble()

colnames(glance_fitsm) <- c("Model 1", "Model 2", "Model 3")

data_fitm <- as.data.frame(tribble(
  ~`Model 1`, ~`Model 2`, ~`Model 3`,
  NA_integer_, lr_12m[2,4], lr_23m[2,4], # lr 
  NA_integer_, lr_12m[2,3], lr_23m[2,3], # df
  NA_integer_, lr_12m[2,5], lr_23m[2,5] # p
    )
  )

data_fit2m <- as.data.frame(bind_rows(glance_fitsm,data_fitm)) %>% round(.,2)

data_fit2m[4,2] <- as.character(signif(data_fitm[3,2], 3))
data_fit2m[4,3] <- as.character(signif(data_fitm[3,3], 3))

rownames(data_fit2m) <- c("AIC", "Likelihood Ratio", "Likelihood Ratio (Df)", "Likelihood Ratio (p-value)")

data_fit2m[is.na(data_fit2m)] <- ""

kable(data_fit2m,
      align = "c",
      caption = "Degree Choice and Migration Status: Model Fit Statistics") |> 
  footnote(footnote_as_chunk = TRUE,
           threeparttable = TRUE, 
           general = "The Likelihood ratio is always calculated with the nested model to the left. Data from the American Community Survey 2015 (collected 2015). Based on a sub-sample of 100000 individuals.")
```

> Table 7 shows the Conditional Choice Model results for what associations and aspirations are connected to post-education job characteristics in which all variables are interacted with the 4-category migration status. It is assumed here that attributes associated with certain degree fields may differentially show themselves in the work related variables across the different migration statuses and similarly to Ma's (2011) findings replicate choice of degree in the respective migration status groups. Although almost all of the covariates produce significant results, most terms show (near) null effects. An exception to this is the mean working hours, where having migrated as an adolescent is associated with significant odds of 0.85, though this has to be interpreted within the context of the interaction term. Ideally, a Wald Test would have been performed to ascertain the difference between, e.g., the interaction of mean worked hours with those who migrated as adolescents and those who did not migrate's interaction with their mean working hours.

```{r clogit}
# What are the alternative specific attributes (i.e., the outcomes associated with degree choice) that are considered desirable by choice makers (and their parents)?

data |> drop_na(degfield) |> filter(empstat == "Employed") -> data_clog

# make a little summarize table
alt_attributes <- data_clog |>
  group_by(degfield) |> 
  filter(n()>=1000) |> 
  summarise(
    n_degree_holders = n(),
    med_age = median(age),
    n_young_migrants = sum(!is.na(age_at_immigration) & age_at_immigration >= 0 & age_at_immigration <= 21),
    p_young_migrants = sum(!is.na(age_at_immigration) & age_at_immigration >= 0 & age_at_immigration <= 21)/n(),
    n_employed = sum(empstat == "Employed"),
    p_employed = sum(empstat == "Employed")/n(),
    n_ym_employed = sum(empstat == "Employed" & !is.na(age_at_immigration) & age_at_immigration >= 0 & age_at_immigration <= 21),
    p_ym_employed_within = sum(empstat == "Employed" & !is.na(age_at_immigration) & age_at_immigration >= 0 & age_at_immigration <= 21)/n_young_migrants,
    p_ym_employed_general = sum(empstat == "Employed" & !is.na(age_at_immigration) & age_at_immigration >= 0 & age_at_immigration <= 21)/n(),
    mean_weekly_hours = round(mean(uhrswork),2),
    mean_tot_income = mean(inctot),
    mean_earned_income = mean(incearn),
    mean_poverty = round(mean(poverty),2)
    )

# id part!
set.seed(1)
sample_degree_holders <- data_clog |> filter(degfield %in% alt_attributes$degfield)
sample_degree_holders$degfield <- fct_drop(sample_degree_holders$degfield)

sample_degree_holders <- sample_degree_holders |> 
group_by(young_migrant) |> 
  slice_sample(n = 5000) |> ungroup() |> mutate(ID = row_number())

size <- 5
alt_attributes$degfield <- fct_drop(alt_attributes$degfield)
alt_attributes |> filter(degfield %in% alt_attributes$degfield) |> pull(degfield) -> alts

sample_degree_holders |> 
  ungroup() |> 
  select(ID) |>  
  mutate(alt = replicate(n(), sample(alts, size = size, replace = FALSE), simplify = FALSE)) |> 
  unnest(alt) |>
  anti_join(sample_degree_holders, by = join_by(ID, alt == degfield)) |> 
  group_by(ID) |> slice(1:(size-1)) ->
  degree_choice


sample_degree_holders |> 
  select(ID, alt = degfield) |>
  bind_rows(degree_choice) |> 
  group_by(ID) |> 
  arrange(ID, alt) |> 
  left_join(sample_degree_holders, by = join_by(ID)) |> 
  left_join(alt_attributes, by = join_by(alt == degfield)) |> 
  mutate(choice = degfield == alt,
         choice = as.numeric(choice)) |> 
  select(-c(yrimmig,yrsusa1,met2013,educd,degfield,stateicp,bpl,age_at_immigration)) -> degree_choice2

# Sanity check good
# sum(degree_choice2$choice) == nrow(sample_degree_holders)
# sum(degree_choice2$choice)*size == nrow(degree_choice2)

library(survival)

degree_choice2 |> rename(`Mean hours worked (week)` = mean_weekly_hours, `Migration Status (dichotomized)` = young_migrant, `Mean Poverty` = mean_poverty, `Mean earned income (year)` = mean_earned_income) -> degree_choice2

m_clog_inter <- clogit(choice ~ `Mean hours worked (week)`:`Migration Status` + `Mean Poverty`:`Migration Status` + `Mean earned income (year)`:`Migration Status` + strata(ID), data = degree_choice2)
#tidy(m_clog_inter) |> View()

tbl_regression(m_clog_inter, exponentiate = TRUE) |>
  modify_header(list(label = "**Covariate**",
                     estimate = "**Odds**")) |>
  modify_footnote(update = list(estimate ~ NA),
                  abbreviation = TRUE) |> 
  modify_caption("Associations with Degree Choice: Conditional Logistic Regression") |>
  as_kable_extra(booktabs = TRUE, escape = FALSE, linesep = "") |> 
  kable_styling(latex_options = "scale_down") |> 
  footnote(footnote_as_chunk = TRUE,
           threeparttable = TRUE, 
           general = "Data from the American Community Survey 2015 (collected 2015). Based on a sample of 5000 randomly chosen individuals in each category of Migration Status.")

#car::lht(m_clog_inter, "ovt=ivt")
# -> Ask Ben about this
```

## Discussion & Conclusion

> The aim of this research paper was to answer whether individuals who have migrated at a young age differ in their choice of tertiary education to non-migrants. Alongside this, questions about the accessibility of college education and the associations and attributions connected to degree fields were posed. It was expected based on previous findings that fewer young migrants pursue tertiary education but that if they do they choose degree fields in which high prestige and pay are expected. Regarding the associations and attributions made at current degree field holders, it was expected that higher pay, less poverty and more working hours would be represented by those who currently work in these fields.

> Comparing this to the empirical findings, there are several contradictory and confirming results. In concordance with the literature review and the hypothesis, those who migrated as children were more likely to hold a college degree than non-migrants and those who migrated as adolescents were significantly less likely to do so. This is in line with findings that relate a negative effect of age at migration on educational attainment. Contradictory to the hypothesis, though in line with some prior findings, migration status seemed to only slightly be associated with not choosing degrees that are low pay and low prestige, i.e., Education. Instead, though also mentioned in the literature review, Race (rather than birthplace), specifically being of Asian ethnicity (though this is likely too broad a category), had the effect that was expected to be present in all individuals who migrated young, that is, greater odds ratios of holding a degree in Engineering and lower odds ratios of holding a degree in education. The results to the final research question are hard to interpret and the hypothesis is not supported by the conditional logistic regression results but it seems to me that the degrees (the alternatives) actually chosen by employed individuals are associated with lower hours worked in those who migrated at all and especially those who migrated as adolescents.

> The results reflect prior findings in the sense that migrating younger seems to lead to better educational assimilation and even an immigrant advantage, though only for those who migrated young enough. All in all, however, migration status and age seem to be trumped by birthplace to some extent and race to a larger extent. It needs to be said however, that the cut-off for migration status variable was chosen rather arbitrarily and that perhaps a continuous operationalization would have been favorable. Additionally, the race and birthplace variables are highly simplifying and their use has actually been discouraged by the literature, especially in cross-sectional research, which is another shortcoming of this research paper. Furthermore, key independent variables referred to by the literature are not available in the data used, such as parental variables, as well as school and neighborhood quality, and religion, among others. Future work should improve on these aspects and more closely inspect the interactions between reason for migration, age at migration, language of target country and birthplace.

## Bibliography
