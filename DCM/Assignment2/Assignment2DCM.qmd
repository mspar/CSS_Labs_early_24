---
title: "Assignment 2 - Obama & Happiness - Discrete Choice Modelling"
author: "Marc Sparhuber"
format: pdf
toc: true
execute:
  warning: false
  echo: false
header-includes:
      - \usepackage{float}
      - \floatplacement{table}{H}
engine: knitr
---

## Loading in Packages & Data

```{r}
library(tidyverse)
library(socviz)
library(modelsummary)
library(broom)
library(scales)
library(modelr)

# Get the data
gss <- gss_sm
```

## Preparing Data & Descriptives

```{r}
# create variable if any parent got a bachelors or graduate degree
# table to check out possible responses & if the answer categories are the same in both variables

# gss |> count(madeg)
# gss |> count(padeg)

gss <- gss |> 
  mutate(parent_degree = as_factor(if_else(padeg == "Bachelor" | madeg == "Bachelor" | padeg == "Graduate" | madeg == "Graduate", "1 or more", "0")),
         obama = recode_factor(obama, `1` = "voted Obama", `0` = "didn't vote Obama")) |> 
  relocate(parent_degree, .after = madeg) |> 
  drop_na(any_of(c("obama", "age", "sex", "happy", "parent_degree")))

# create table

datasummary((`Age` = age) + (`Sex` = sex) + (`Bachelor or Graduate degrees of parents` = parent_degree) + (`Obama` = obama) + (`Happiness` = happy) + 1 ~ obama * (Mean + SD + N + Percent()),
                       data = gss,
                       title = "Descriptives split by voting for Obama",
                       notes = c("Comments: Data from the General Social Survey R package."))
```

## Model Estimaton & Odd Ratios

```{r}
# set "Not Too Happy" as reference category
#levels(gss$happy)

gss <- gss |> mutate(happy = fct_relevel(happy, "Not Too Happy"))

# a) only the happiness variable.

happy_lrm <- glm(obama ~ happy, data = gss, 
                       family = "binomial"(link = "logit"))
nobs(happy_lrm)
summary(happy_lrm)

# b) same as a), plus the new parental education variable.

happy_education_lrm <- glm(obama ~ happy + parent_degree, data = gss, 
                       family = "binomial"(link = "logit"))
nobs(happy_education_lrm)
summary(happy_education_lrm)

# c) same as b), plus sex and age variables.

happy_education_sex_age_lrm <- glm(obama ~ happy + parent_degree + age + sex, data = gss, 
                       family = "binomial"(link = "logit"))
nobs(happy_education_sex_age_lrm)
summary(happy_education_sex_age_lrm)

mods <- list(
  "Model 1" = happy_lrm,
  "Model 2" = happy_education_lrm,
  "Model 3" = happy_education_sex_age_lrm)

modelsummary(mods,
             stars = TRUE,
             gof_omit = "F|RMSE",
             title = "Voting for Obama. Logistic probability models",
             notes = list("Source: General Social Survey data from the socviz R package.", 
                          "Comments: The reference cateogory for happy is 'Not Too Happy'."),
             statistic = "conf.int",
             exponentiate = TRUE)
```

```{r}
estimates_third_mod <- tidy(happy_education_sex_age_lrm, exponentiate = TRUE, conf.int = TRUE)

estimates_third_mod |> 
  filter(term != "(Intercept)") |>  
  ggplot(aes(term, estimate)) +
  geom_hline(yintercept = 0.2744810, color = "red", linetype = "dashed") +
  geom_point() +
  scale_y_continuous(breaks = seq(0, 3.5, by = .2), limits = c(0, 3.5)) +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high, width = .1))+
  labs(title = "Voting for Obama: Logistic Regression",
       y = "Odds ratios",
       x = "Variables",
       caption = "General Social Survey Data from the socviz R Package.")
```

## Predicted Probabilities

```{r}
# log_pred_mod3 <- augment(happy_education_sex_age_lrm,
#                          type.predict = "response",
#                          se_fit = TRUE,
#                          newdata = data_grid(gss, age, happy))
```

## Model Fit

```{r}

```

## Conclusion

