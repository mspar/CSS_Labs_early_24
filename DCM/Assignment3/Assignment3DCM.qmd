---
title: "Assignment 3 DCM - Party Vote and Views on Immigration in the UK"
author: "Marc Sparhuber"
format: pdf
editor: source
execute:
  warning: false
  echo: false
toc: true
header-includes:
      - \usepackage{float}
      - \floatplacement{table}{H}
---

\newpage 

## Introduction

> The following analysis tests the research question of whether vote choice in the UK can be explained by whether an inidividual considers immigration as beneficial for the quality of life in the UK. It is expected that considering immigration beneficial for the quality of life in the UK is associated with a greater likelihood of having voted Labour in the last general election (2019), as conservative parties globally tend to disincentivize migration to their country for prospective migrants, as well as market themselves as anti-immigrant during campaigning, which the Tories have done frequently in the past and before the 2019 general election, therefore attracting votes from people who think that their country would be better off without immigrantion. It is assumed that people who have voted for them for these reasons still held them when interviewed for the ESS in 2020-2022.

```{r}
library(tidyverse)
library(haven)
library(modelsummary)
library(knitr)
library(kableExtra)

ess2018_uk <- read_dta("C:/Users/User/Desktop/Labs and Assignments Winter early 24/CSS_Labs_early_24/DCM/Assignment3/ESS10_gb.dta")
#ess2018_uk <- read_dta("C:/Users/marcs/Desktop/Labs/CSS_Labs_early_24/DCM/Assignment3/ESS10_gb.dta")
```


```{r}
data <- ess2018_uk |> 
  select(prtvtdgb, imwbcnt, gndr, agea, edulvlb, mode) |>
  drop_na(prtvtdgb, imwbcnt, gndr, agea, edulvlb) |>
  mutate(tertiary_education = as_factor(if_else(as.numeric(edulvlb) > 500, 1, 0)),
         party_vote = fct_relevel(fct_collapse(as.factor(prtvtdgb),
                                   "Labour" = 2,
                                   "Liberal Democrat" = 3,
                                   "Conservative" = 1,
                                   other_level = "Others"
                                   ), "Labour"),
         gender = as.factor(if_else(gndr == 1, "Male", "Female")),
         age = as.numeric(agea),
         Immigration = as.numeric(imwbcnt)
         ) |>
  select(-c(prtvtdgb, imwbcnt, gndr, agea, edulvlb))
```

## Data

```{r}
datasummary((`Tertiary Education` = tertiary_education) + (`Vote General Election 2019` = party_vote) + (`Gender` = gender) + Heading("Immigration Attitude", nearData = FALSE) * Immigration + Heading("Age", nearData = FALSE) * age + Heading("All", nearData = FALSE) * 1 ~ Mean + Median + SD + N + Percent(),
                       data = data,
                       title = "European Social Survey (UK, 10th round): Descriptive statistics") |>
                       kable_styling(latex_options = "scale_down")
```

> To answer this research question, data from the 10th round (collected 2020 to 2022) of the European Social Survey collected in the UK is used, which is conducted every 2 years and included over 600 columns of data. Of this data, only responses participants who had no missing data in any of the variables presented in Table 1 were taken into account. This reduces the sample size from 1149 to 809. Of the remaining data points, 95% of participants were interviewed face to face, while the other 5% took part in a web-based video interview.

> Table 1 shows descriptive statistics used in the analysis. Tertiary education is distributed evenly withing the sample and is coded 1 when the respondent reported their highest level of education to be at least tertiary education below bachelor level and 0 otherwise. The party choice was collapsed to include only Labour, Conservative, Liberal Democrat and Other, which included all other parties. A result of this could be the under-representation of individuals outside England that did not vote any of the listed above parties, as party choice and size in other UK countries can strongly vary (e.g., Sinn Féin in Northern Ireland or the SNP in Scotland). The repondents' 2019 general election votes differ slightly from the actual election outcomes, with Labour receiving 40% of the vote (33% in the sample), the Tories 42% (44%), and the Liberal Democrats 11% (7%). This divergence may be due to the above mentioned parties being lumped in with "Others", who make up the rest of the sample.

> Immigration attitude, the main independent variable, was assessed with a 11-point Likert scale ranging from 0 (Worse) to 11 (Better) in response to the statement 'Immigrants make country worse or better place to live'. In the sample, the mean Immigration attitude is 6.44 - so, 'slightly better'. With a median of 7 and a standard deviation of 2.36. The sample had slightly more female respondents (54%) and the mean age was 58, with a median of 60 and a standard deviation of 17. All in all, this sample seems to be mostly representative of the UK voting age public, despite individuals with tertiary education and women being overrepresented.

## Results

```{r}
library(nnet)
library(broom)
library(modelr)

mod_no_Immigration <- multinom(party_vote ~ gender + age + tertiary_education, data = data, trace = F, model = T, na.action = na.exclude)
mod_Immigration <- multinom(party_vote ~ gender + age + tertiary_education + Immigration, data = data, trace = F, model = T, na.action = na.exclude)

mods <- list(
  "Model 1" = mod_no_Immigration,
  "Model 2" = mod_Immigration)

cm <- c("genderMale" = "Male",
        "age" = "Age",
        "tertiary_education1" = "Tertiary Education",
        "Immigration" = "Immigration Attitude")

modelsummary(mods, shape =  term ~ model + response,
              fmt = 2,
              statistic = 'conf.int',
             title = "Voting in the 2019 UK general election: Multinomial logistic regression",
             exponentiate = TRUE,
             stars = TRUE,
             gof_omit = "RMSE|R2|R2 Adj.",
             coef_map = cm,
              notes = list("Source: ESS data from the 10th round in the UK.", 
                           "Comments: Immigration attitude was assessed with the question:",
                           "'Immigrants make country worse (0) or better (10) place to live'. The reference category is 0.",
             "The reference category for the voted for party is Labour.")
             ) |> kable_styling(latex_options = "scale_down")
```

> To answer the research question, two multinomial regression models are run, as can be seen in Table 2. Their dependent variables are the vote cast in the UK general election of 2019, which includes the parties listen in Table 1 with Labour as a reference value. While there seems to be no significant association between gender and vote cast in either of the models, age is consitently significant, though the corresponding odds ratios show only miniscule effects pointing toward higher age voters for the conservatives, liberal democrats and other parties compared to Labour. This ought to not be overlooked, however, because each additional year of life, the odds of voting conservative grow 1.04 times larger, compared to Labour voters. Due to not squaring age, it is not certain whether a non-linear association with age was overlooked (this is because I couldn't get the squared term to work). Looking at tertiary education the only significant effect is seen in Model 1 with the odds of voting Conservative, compared to Labour, decreasing by a factor of 0.61 when having experienced tertiary education, indicating a negative effect. Both models do contain marginally significant positive effects of tertiary education on having voted Liberal Democrat but due to the non-significance they should be interpreted with care. The second model introduces the previously mentioned immigration-quality of life variable. As a consequence, the significant negative effect of tertiary education on voting Conservative disappears, suggesting that adding the immigration variable may lead to multicollinearity. So the odds of voting Conservative compared to Labour decrease by a factor of 0.72 for each unit increase in the immigration variable (11-point Likert item). So it seems that being older and having negative views on immigration seem to predict voting conservative.

```{r}
#| fig-align: center

library(DescTools)
library(lmtest)

lr_test <- lrtest(mod_no_Immigration, mod_Immigration)

mod1_nagel <- PseudoR2(mod_no_Immigration, which = "Nagelkerke")
mod2_nagel <- PseudoR2(mod_Immigration, which = "Nagelkerke")


mf1 <- model.frame(party_vote ~ gender + age + tertiary_education,
                     data = data, na.action = na.omit)
mf2 <- model.frame(party_vote ~ gender + age + tertiary_education + Immigration,
                     data = data, na.action = na.omit)


mod1_pred <- predict(mod_no_Immigration, type = "class") |> 
  as_tibble() |> 
  bind_cols(mf1)
share_correct_m1 <- mean(mod1_pred$value == mod1_pred$party_vote)

mod2_pred <- predict(mod_Immigration, type = "class") |> 
  as_tibble() |> 
  bind_cols(mf2)
share_correct_m2 <- mean(mod2_pred$value == mod2_pred$party_vote)

data_fit <- as.data.frame(tribble(
  ~`Model 1`, ~`Model 2`,
  as.character(round(mod1_nagel,5)), as.character(round(mod2_nagel,5)),
  as.character(round(share_correct_m1,5)), as.character(round(share_correct_m2,5)),
  " ", as.character(round(lr_test[2,4],5)),
  " ", as.character(round(lr_test[2,5],5))))

rownames(data_fit) <- c("Nagelkerke’s pseudo-R2", "Share of correct predictions", "Likelihood Ratio", "Likelihood Ratio (p-value)")

kable(data_fit,
      caption = "Voting in the 2019 UK general election: Model fit statistics") |> 
  footnote(footnote_as_chunk = TRUE,
           threeparttable = TRUE, 
           general = "The Likelihood ratio is always calculated with the nested model to the left. Data from ESS (UK, 10th round).")
```

> Looking at the model fit statistics in Table 3 shows that these models are not very well specified. Though Nagelkerke's pseudo R2 increases from Model 1 to 2, the values are still fairly low, indicating low levels of explained variance (though this is technically not captured by Nagelkerke's R2). The share of correctly predicted vote choices improves from Model 1 at 0.52 to 0.55 for Model 2. This means that only roughly half of predictions are correct, making this a very weak model that performs only slighly better than random guesses. Calculating the likelihood ratio of model 1 to 2 it is evident that adding the immigration item to the second regression model increases its fit significantly. Overall, however, the model does not perform very well regardless.

```{r}
#| fig-width: 10
#| fig-height: 6
#| fig-align: center

library(ggeffects)
library(scales)

vote_prob_immigration <- ggeffect(mod_Immigration, terms = c("Immigration", "tertiary_education"))

labels <- list(
  '0'="No Tertiary Education",
  '1'="Tertiary Education"
)

custom_labeller <- function(variable,value){
  return(labels[value])
}

vote_prob_immigration |> 
  ggplot(aes(x, predicted, colour = response.level, fill = response.level)) +
  geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), 
              alpha=0.5, colour = NA) +
  scale_y_continuous(labels = label_percent()) +
  scale_x_continuous(breaks = seq(0, 10, by = 2)) +
  theme_light() +
  labs(title = "Party choice in the 2019 UK general election split by tertiary education",
       subtitle = "Estimates from multinomial logistic regression",
       x = "Immigrants make country worse (0) or better (10) place to live",
       y = "Predicted probability",
       caption = "Data from ESS (UK - 10th round)",
       colour = "Party",
       fill = "Party",
       tag = "Figure 1") + facet_wrap(vars(group), labeller = custom_labeller)
```

> Figure 1 shows the predicted probabilites for the 4 possible values of party choice predicted by the response to the immigrant item and split by whether tertiary education was attended or not. The predicted probability of voting Conservative for those without tertiary education falls from ~80% to ~20% going from 0 to 10 on the immigration item. This shows that the more someone answered that immigrants make the UK a better place to live, the less likely they were to be predicted to vote Conservative. The opposite is true for the predicted probability of voting Labour, though to a lesser degree from ~10% at 0 on the immigration item to ~45% at its maximum value. The predicted probability for voting LibDem and Others are fairly similar and gradually increase across the Likert item from roughly 3% to around 20%. Moving to the predicted probabilities for those with tertiary education, it is evident that there are only small changes, reflecting the insignificant model coefficients of tertiary education in Table 2. All in all, the predicted probabilites for different party votes for those with tertiary education seem to become less defined, with a vote for Labour and Conservative being 5-10% percent less predicted and the LibDems and Others gaining these lost percentage points. These results suggest the difference in importance of immigration issues among party lines. While for Labour,  migration-positive and for Conservatives a migration-negative political action/campaigning are relevant, other parties (due to being lumped together) and LibDem voters seem to not clearly cluster into a either migration-positive or migration-negative camp.

## Conclusion

> Supporting the initial expectation, current immigration attitudes seem to play a significant role in party choice in the last general election in the UK. Interestingly, it seems that the negative effect of tertiary education on voting Conservative, compared to Labour, loses its signficance, when adding immigration attitudes to the model. This indicated that more than being well educated or not, current immigration attitudes reflect past voting choices. Not very surprisingly, younger voters seemed to have a slight preference for Labour, though non-linear effects were not accounted for in the analysis. Finally, voting labour seems to be positively associated with positive immigration attitudes when compared to voters of other parties.
